{% extends "base.html" %}

{% block title %}{{ user_obj.name }} - Kentaur Onboarding{% endblock %}

{% block content %}
<div class="mt-14">
    <div class="flex items-center justify-between mb-6">
        <div>
            <a href="{% url 'core:user_list' %}" class="text-sm text-gray-500 hover:text-gray-700 mb-1 inline-block">&larr; Tilbage til brugere</a>
            <div class="flex items-center gap-4 mt-1">
                <div class="flex-shrink-0 w-14 h-14 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center text-xl font-bold">
                    {{ user_obj.initials }}
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">{{ user_obj.name }}</h1>
                    <p class="text-gray-500">{{ user_obj.title }}{% if user_obj.title and user_obj.department %} &middot; {% endif %}{{ user_obj.department }}</p>
                </div>
            </div>
        </div>
        <div class="flex gap-2">
            <a href="{% url 'core:user_edit' user_obj.pk %}"
               class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-indigo-700 transition">
                Rediger
            </a>
            <form method="post" action="{% url 'core:user_toggle_active' user_obj.pk %}">
                {% csrf_token %}
                {% if user_obj.is_active %}
                <button type="submit" class="bg-red-50 text-red-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-100 transition"
                        onclick="return confirm('Deaktiver brugeren {{ user_obj.name }}?')">
                    Deaktiver
                </button>
                {% else %}
                <button type="submit" class="bg-green-50 text-green-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-100 transition">
                    Aktiver
                </button>
                {% endif %}
            </form>
            <a href="{% url 'core:user_delete' user_obj.pk %}"
               class="bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-700 transition">
                Slet
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        <div class="bg-white shadow rounded-lg p-6">
            <h3 class="text-sm font-medium text-gray-500 mb-3">Kontaktoplysninger</h3>
            <dl class="space-y-2 text-sm">
                <div>
                    <dt class="text-gray-400">Email</dt>
                    <dd class="text-gray-900">{{ user_obj.email }}</dd>
                </div>
                {% if user_obj.phone %}
                <div>
                    <dt class="text-gray-400">Telefon</dt>
                    <dd class="text-gray-900">{{ user_obj.phone }}</dd>
                </div>
                {% endif %}
            </dl>
        </div>
        <div class="bg-white shadow rounded-lg p-6">
            <h3 class="text-sm font-medium text-gray-500 mb-3">Status</h3>
            <dl class="space-y-2 text-sm">
                <div>
                    <dt class="text-gray-400">Konto</dt>
                    <dd>
                        {% if user_obj.is_active %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Aktiv</span>
                        {% else %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600">Inaktiv</span>
                        {% endif %}
                    </dd>
                </div>
                <div>
                    <dt class="text-gray-400">Autentificering</dt>
                    <dd class="text-gray-900">{{ user_obj.get_auth_method_display }}</dd>
                </div>
                {% if user_obj.azure_ad_object_id %}
                <div>
                    <dt class="text-gray-400">Azure AD ID</dt>
                    <dd class="text-gray-900 text-xs font-mono">{{ user_obj.azure_ad_object_id }}</dd>
                </div>
                {% endif %}
            </dl>
        </div>
        <div class="bg-white shadow rounded-lg p-6">
            <h3 class="text-sm font-medium text-gray-500 mb-3">Opgavestatistik</h3>
            <dl class="space-y-2 text-sm">
                <div>
                    <dt class="text-gray-400">Aktive opgaver</dt>
                    <dd class="text-2xl font-bold text-indigo-600">{{ assigned_tasks|length }}</dd>
                </div>
                <div>
                    <dt class="text-gray-400">Fuldf√∏rte opgaver</dt>
                    <dd class="text-2xl font-bold text-green-600">{{ completed_count }}</dd>
                </div>
            </dl>
        </div>
    </div>

    {% if assigned_tasks %}
    <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-semibold text-gray-900">Aktive opgaver</h2>
        </div>
        <div class="divide-y divide-gray-100">
            {% for task in assigned_tasks %}
            <a href="{% url 'onboarding:task_detail' task.onboarding.pk task.pk %}"
               class="flex items-center justify-between px-6 py-3 hover:bg-gray-50 transition">
                <div>
                    <div class="text-sm font-medium text-gray-900">{{ task.name }}</div>
                    <div class="text-xs text-gray-500">{{ task.onboarding.new_employee_name }}</div>
                </div>
                <div class="flex items-center gap-3">
                    {% if task.status == 'ready' %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">Klar</span>
                    {% elif task.status == 'in_progress' %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">I gang</span>
                    {% else %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-500">Afventer</span>
                    {% endif %}
                    {% if task.deadline %}
                    <span class="text-xs {% if task.is_overdue %}text-red-600 font-medium{% else %}text-gray-400{% endif %}">
                        {{ task.deadline|date:"d/m" }}
                    </span>
                    {% endif %}
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
